# region File Name and Path
INDUSTRY_ANALYSIS_FOLDER = r"C:\Python\data\agent\industry_analysis"
INDUSTRY_PICKLE_FN = "industry_analysis.pkl"
# endregion

# region Prompts



INDUSTRY_ASK = """
你是{REGION_PLACEHOLDER}市场的top-down 股票对冲基金行业策略研究员。我们用统一框架评估{INDUSTRY_PLACEHOLDER}并形成子行业多空建议。 
请使用最新的信息！

Step 0：先拆成可交易子行业（不超过10个，可以少不能多）  
按照结合实际业务和市场关注的方向或者主题进行拆分。比如半导体里的存储，SPE。比如工业里面的数据中心电力，液冷等等。

Step 1：3M3T对每个子行业输出 M1/M2/M3的分析（事实与假设，注明不确定）
通过 3个M 看本质，透过本质看未来的表象。股价，盈利都是外在表象，背后是有内在规律决定的，行业内在规律由 3M 决定的。这样思考的速度才能超越市场。
3个M是把“ROE/利润的变化”关进房间（可边界化的原因分解）。3个M 不是行业报告目录，而是解释ROE/COE变化来源的“可约束分解法”，防止叙事无限外延：
o M1 TAM：蛋糕上限/下限与弹性（空间边界、需求可塑性）。
o M2 Share：份额可得性与稳定性（竞争格局、替代与进入壁垒）。
o M3 Margin：利润率与成本结构（供需、价格传导、成本曲线、产能周期；最常见的周期与竞争传导路径）。
每个M可以思考T1, T2, T3不同时间维度上的影响：
- T1（0–3m）：短期扰动与情绪波动最密集，很多所谓预期差只是噪音或交易拥挤的回摆。
- T2（3–18m）：业绩与一致预期修正的主战场；职业投资者往往必须在此区间“认真管理噪音”。
- T3 (18m+)：结构与复利的战场，决定护城河与资本回报是否可持续（ROE的长期路径）。

Step 2：由3个M 推导 D1/D2/D3（推理必须显式写“因为…所以…”，不允许跳步）
---D1 = Roll-up / 复利（EPS 与 B 的滚动）
o “时间的价值”：只要商业模式与护城河成立，高 ROE 与现金创造会自然推高价值。
o 讨论焦点：可持续性、复利机制是否成立、是否值得长期持有；D1 的力量主要在 T2/T3 兑现。要研究透彻高 ROE 的护城河是什么，高 ROE 为什么可持续，背后的生意模式是什么，如果高成长背后的核心驱动是什么？
o 经验锚点：可用“是否像巴菲特愿意长期持有的生意”来检验 D1 的内涵（生意质量、护城河、资本配置纪律）。
o D1 可以理解为 ROE 或者 CAGR，偏价值就是看 ROE，偏成长就是 CAGR。ROE 要看护城河，CAGR 要看 M1，M2，M3 的确定性是否支撑 CAGR。
---D2= 预期差的“实质化”/ 非线性变化（常触发 rerating）
o 不是“我和市场看法不一样”就算 D2；真正的 D2 来自 5M 的变化导致ROE/FCF 路径发生非线性偏移（上修/下修），并逐步迫使一致预期修正。
o 灵魂三问：多大（幅度）/多快（速度）/多长（持续性）。
o D2 是双刃剑：它既能证明/强化 D1（或证伪 D1），也容易让研究者“一叶障目”，忽略 D1 地基或 D3 已经把变化 priced-in。
o Think different 才能看清 D2，但是不是让你和市场对着干，不是让你和 consensus对着干，是做出 smart choice，有三点：更多的搜索研究，严格的框架，有智慧的推导。
o 周期语境下的 D2：关键在“方向 + 位置”。靠近周期转换段时确定性弱（更像与市场博弈）；周期中段确定性更强。
o 对于抓 D2 投资的假设一定是源于大概率事件。D2 的来源是结构或者周期，结构是你和别人观点不一样 Yes vs No，周期是你判断一些事情持续时间比consensus 长或者短，程度高或者低，所以这个consensus 需要把握好 price in 了多少，找到市场 consensus 错误的假设，需要你大量的掌握信息。
---D3 = Range / 估值钟摆（估值的摆动 + range 漂移）
o D3 讨论“现在价格处在情绪钟摆哪一端”以及“钟摆长度/锚点是否变化”。
o 两层含义：1) range 内摆动：均值回归/情绪回摆（相对位置交易）。 2) range漂移：估值中枢上移/下移（常由D2、利率/流动性regime切换、长期 ROE 结构变化触发）。
o 波动不是风险，搞不懂的波动才是风险。D3 的 driver 就是波动，如果波动小全靠 D1/D2。
o 角色定位：D3 更像回撤管理与赔率调制器（buffer），而不是投资起点；它为 D1/D2 可能判断错误提供安全边际，但不能替代 D1 的质量或 D2 的实质变化。
其他3D的解释：
* 重要性的顺序是按 1/2/3 来走的，D3 是 D1/D2 可能错误的 buffer，不是投资起点，而是投资 RR的添加剂。所以芒格强调是合理价格买好公司（D1），而不是便宜价格（D3）买普通公司。
* D1 的 power 在 T2/T3，D2 的 power 在 T1/T2。D1 D2 D3 的组合里，最确定的还是 D1+D3，好公司在合理的价格 – 巴菲特style，跌下去敢买。最不确定的是 D2 +D3，是主观的判断，跌下去不一定敢买。做多要有 D1，做空考虑 D2。
* D1 很强，但是在 T2，T3 看到了向下的 D2，但 D3 在 range 的中间。这个能不能 short 呢？要看 D2 有多强，能不能改变 D1，市场相不相信能改变 D1。还有看 D2 是不是已经 price in，price in 了多少，以及看 D2 的影响是结构性的还是长周期的。如果是长周期的即使在 range 中间也可以 short。
* 投资本质就是盈利的研究，M1 是蛋糕多大，M3 是吃的速率，反应出来可能是影响 D1，D2，D3。D2 会 Trigger D3，也会证明（证伪）D1
* short 逻辑：就是 D2（盈利预期差）和 D3 双杀。盈利预期差或者来源于周期（M1/M3）或者来源于结构 (M2)
* 只看 D3 是不行的，是赚别人错误的钱，但是加上 D1 和 D2 才是赚时间价值，公司增长的钱。D1 是为股东创造价值的公司，D2 是为股东更快创造价值的公司，D3 才是合理的价格。


Step 3：交易结论
你的结论应该是基于D1,D2,D3。

根据以上研究框架，请给出：
每个子行业给出明确结论(子行业多空)：Long/Short/Neutral（注意 第一条应该是大行业总览，然后每个子行业）
接着给出一句话总结，格式为：置信度（0–100） |  时间框架（T1:0–3月/ T2: 3–18个月/T3: >18个月） | D1 (1/0/-1) | D2 (1/0/-1) | D3 (1/0/-1) | M1 (1/0/-1) | M2 (1/0/-1) | M3 (1/0/-1)
还要给出一组建议交易的Ticker。注意这个子行业必须是Long/Short/Neutral，不在子行业内做配对，如果子行业是Neutral，不需要给Ticker

 
输出格式：最后只输出一个json (JSON ONLY!)，每个string尽量bullet form。

OUTPUT FORMAT (JSON ONLY, NO URL!!!) 
[
    {{ 
    "子行业": "string，不用写分类原因，只要简单的子行业名称，注意 第一条应该是大行业总览", 
    "子行业多空"： "Long/Short/Neutral",
    "结论":  "严格按照这个格式，举例：置信度 85 | 时间 T1 （可多i选） | D1 (1) | D2 (1) | D3 (-1) | M1 (1) | M2 (0) | M3 (1)", 
    "M1":  "string，不要加上url引用", 
    "M2":  "string，不要加上url引用", 
    "M3":  "string，不要加上url引用", 
    "D1":  "string，不要加上url引用", 
    "D2":  "string，不要加上url引用", 
    "D3":  "string，不要加上url引用", 
    "建议交易Ticker":  "string，第一行的大行业总览不需要写建议交易的Ticker，可以留空白，其他的 TICKER1 | TICKER2 | TICKER3 | .......，不要有公司名，给出不超过5个你最有conviction的个股Ticker(Yahoo finance用的格式)，比如012450.KS, 601398.SS,002475.SZ,9843.T,AAPL,9988.HK,2330.TW,",
    "使用的URL链接引用": "所有的参考引用url放在这里"
     }},
     ...
]
"""


# endregion

# region Def

REGION_DEF = [
    "中国+香港",
    "台湾",
    "美国",
    "欧洲",
    "日本",
    "韩国"
]

OPTIMIZED_INDUSTRIES = {
    1: "银行与消费信贷（含信用卡/车贷/按揭/学生贷）",
    2: "保险（寿险 / 财险 / 再保）",
    3: "资本市场与财富管理（投行 / 券商 / 资管 / 交易所 / 清算与市场基础设施）",
    4: "支付与金融科技（支付网络 / 收单 / BNPL / 核心系统等）",

    5: "房地产开发、住宅建筑与地产服务（开发 / 经纪 / 物业 / 建材分销）",
    6: "REITs（按物业类型可再细分：数据中心 / 工业 / 住宅 / 零售 / 医疗 / 特殊用途等）",

    7: "油气上游与综合能源（E&P / 综合石油公司）",
    8: "中游管网与LNG产业链（管道 / 储运 / LNG出口相关）",
    9: "油服与能源设备服务",
    10: "公用事业与电网（受监管电力 / 输配电 / 独立发电IPPs）",
    11: "电气化与电力设备（变压器 / 开关设备 / HVDC / 配电 / 数据中心供配电与制冷配套）",
    12: "新能源与储能（光 / 风 / 储能 / 逆变器 / 氢等）",

    13: "金属矿产与关键资源（铜 / 铝 / 锂 / 稀土 / 煤等）",
    14: "化工与材料（基础化工 / 特种化学 / 先进材料）",

    15: "工业制造与自动化（机械 / 机器人 / 工厂自动化 / 测试测量 / 通用设备）",
    16: "工程建设与环境服务（EPC / 基建 / 工程咨询 / 环境）",
    17: "交通运输与物流（航运 / 港口 / 铁路 / 航空 / 快递 / 仓储等）",
    18: "汽车与智能出行（整车 / 零部件 / 经销 / 出行平台）",
    19: "国防、航空航天与安全（军工主机厂 / 供应链 / 航天 / 国土安全）",

    20: "半导体与设备（含EDA / 设备 / 材料）",
    21: "硬件与电子组件（服务器OEM / 存储 / 光模块 / 消费电子 / 工业电子）",
    22: "数字基础设施（数据中心运营 / 机房服务 / 通信塔 / 光纤 / 卫星网络等）",
    23: "软件与SaaS（企业应用 / 基础软件 / 开发工具 / 数据分析 / AI应用软件）",
    24: "IT服务与云解决方案（咨询 / 集成 / 外包 / 托管服务MSP等）",
    25: "互联网平台与数字广告（搜索 / 社交 / 内容分发 / 短视频等）",
    26: "电商与本地生活平台（综合 / 垂直 / 到家到店 / 履约网络）",

    27: "消费品牌与零售（品牌商 / 全渠道零售 / 专卖连锁 / 商超等）",
    28: "餐饮、酒店旅游与休闲服务（餐饮连锁 / 酒店 / OTA / 邮轮 / 乐园等）",

    29: "医药（大药企 / 仿制药 / 原料药）",
    30: "生物科技与生命科学服务（创新药 / 生物科技 / CRO / CDMO）",
    31: "医疗器械、诊断与医疗服务（器械 / IVD / 医院与专科连锁 / 第三方检验影像等）",
}


# endregion